<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
  <head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
<link rel="stylesheet" href="style.css" type="text/css" charset="utf-8" />
<link rel="stylesheet" href="custom.css" type="text/css" charset="utf-8" />
<link rel="stylesheet" href="syntax_highlight.css" type="text/css" charset="utf-8" />

    <script src="jquery.js" type="text/javascript" charset="utf-8"></script>
    <script src="app.js" type="text/javascript" charset="utf-8"></script>
    <title>Module: UDDFactor</title>
  </head>
  <body>
    <div id="content">
      <div class="section module UDDFactor">
  <h1 class="title">Module: UDDFactor</h1>
  <div class="section mixins">
  <h1>Included Modules</h1>
  <p><a title="GenFactor" href="UDDFactor/GenFactor.html">GenFactor</a>, <a title="MortalityTable" href="UDDFactor/MortalityTable.html">MortalityTable</a></p>
</div>
<div class="section constants">
  
</div>  <div class="section visibilitygroup public">
    <h1>Public Visibility</h1>
      <div class="section methodsummary instance public">
    <h1>Public Instance Method Summary</h1>
<table class="summary">
  
    <tr>
      <th class="signature">
        
          <span class='overload'>
            <span class='name'><a title="#calculate_present_value" href="#calculate_present_value-instance_method">#calculate_present_value</a></span><span class='args'>(immAge, defAge, spouseAge, js_type, js_pct, mortality, seg1, seg2, seg3, certain, temp, rounding)</span>
            <span class='block'></span>
          </span>
        
        
      </th>
      <td class="docstring">
        <p>
Calculates the present value of each unit payment and sums them to create a
factor.
</p>

        
          <p class='returns'>
            Returns: 
              <span class='return_types'>
                 <tt>float</tt>
              </span>
          </p>
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        
          <span class='overload'>
            <span class='name'><a title="#generate_factor" href="#generate_factor-instance_method">#generate_factor</a></span><span class='args'>(immediateAge = 0.0, commencementAge = 65.0, spAge = 0.0, jsType = 0.0, jsPct = 0.0, mortality = MortalityTable::PPA2009, intSegmentA = 5.0, intSegmentB = 0.0, intSegmentC = 0.0, certainPeriod = 0.0, tempPeriod = 0.0, rounding = 12.0, outputType = 0.0)</span>
            <span class='block'></span>
          </span>
        
        
      </th>
      <td class="docstring">
        <p>
Validates input parameters then generates a Present Value Factor.
</p>

        
          <p class='returns'>
            Returns: 
              <span class='return_types'>
                 <tt>float</tt>
              </span>
          </p>
        
      </td>
    </tr>
  
</table>
<div class="included">
  
  <div>
    <h1>Public Instance Methods Included from <a title="GenFactor" href="UDDFactor/GenFactor.html">GenFactor</a></h1>
    <p><span class='name'><a title="add_month" href="GenFactor.html#add_month-instance_method">add_month</a></span>, <span class='name'><a title="append_error" href="GenFactor.html#append_error-instance_method">append_error</a></span>, <span class='name'><a title="calculate_discount" href="GenFactor.html#calculate_discount-instance_method">calculate_discount</a></span>, <span class='name'><a title="calculate_dx" href="GenFactor.html#calculate_dx-instance_method">calculate_dx</a></span>, <span class='name'><a title="calculate_initial_lx" href="GenFactor.html#calculate_initial_lx-instance_method">calculate_initial_lx</a></span>, <span class='name'><a title="calculate_joint_factor" href="GenFactor.html#calculate_joint_factor-instance_method">calculate_joint_factor</a></span>, <span class='name'><a title="calculate_qx" href="GenFactor.html#calculate_qx-instance_method">calculate_qx</a></span>, <span class='name'><a title="interest_discount" href="GenFactor.html#interest_discount-instance_method">interest_discount</a></span>, <span class='name'><a title="round_factor" href="GenFactor.html#round_factor-instance_method">round_factor</a></span>, <span class='name'><a title="sanitize_age" href="GenFactor.html#sanitize_age-instance_method">sanitize_age</a></span>, <span class='name'><a title="sanitize_interest" href="GenFactor.html#sanitize_interest-instance_method">sanitize_interest</a></span>, <span class='name'><a title="sanitize_js_pct" href="GenFactor.html#sanitize_js_pct-instance_method">sanitize_js_pct</a></span>, <span class='name'><a title="sanitize_js_type" href="GenFactor.html#sanitize_js_type-instance_method">sanitize_js_type</a></span>, <span class='name'><a title="set_default" href="GenFactor.html#set_default-instance_method">set_default</a></span>, <span class='name'><a title="unit_payment" href="GenFactor.html#unit_payment-instance_method">unit_payment</a></span>, <span class='name'><a title="validate_float" href="GenFactor.html#validate_float-instance_method">validate_float</a></span>, <span class='name'><a title="yearly_discount" href="GenFactor.html#yearly_discount-instance_method">yearly_discount</a></span></p>
  </div>
  
</div>
<div class="clear"></div>
  </div>
<div class="section methoddetails instance public">
  <h1>Public Instance Method Details</h1>
  
    <div class="method">
      <div class="method_header">
  <h3>calculate_present_value</h3>
</div><div id="calculate_present_value-instance_method" class="section method">
  <div class="details_title">
    <div class='section methodsignature'>
    <tt class='def'>
      <span class='visibility'>public</span>
      <span class='return_types'><tt>float</tt></span>
      <span class='name'>calculate_present_value</span><span class='args'>(immAge, defAge, spouseAge, js_type, js_pct, mortality, seg1, seg2, seg3, certain, temp, rounding)</span>
      <span class='block'></span>
    </tt>
  </div>

</div><div class="section docstring">
  <p>
Calculates the present value of each unit payment and sums them to create a
factor. This method lacks the validation of generate_factor.
<tt><a title="#generate_factor" href="#generate_factor-instance_method">#generate_factor</a></tt> should be called instead.
</p>

</div><div class="section tags">
  <h2>Meta Tags</h2>
  <div class="examples">
  
    <h3>Example: <small>A 47% percent joint and survivor factor.</small></h3>
    <div class="docstring">
      <pre class="code"><span class='string val'>&quot;calculate_present_value(65.0,65.0,61.0,2.0,0.47,0.0544,0.0544,0.0544,0.0,0.0,6.0)&quot;</span>
</pre>
    </div>
  
</div>
<div class="param">
  <h3>Parameters:</h3>
  <dl>
  
    
      <dt>
        <span class='type'>[<tt>Object</tt>]</span>
        <span class='name'>immAge</span>
        
      </dt>
      <dd>
        <span class='desc'><ul>
<li>Immediate Age: The age to start deferral calculations from.

</li>
</ul>
</span>
      </dd>
    
  
    
      <dt>
        <span class='type'>[<tt>Object</tt>]</span>
        <span class='name'>defAge</span>
        
      </dt>
      <dd>
        <span class='desc'><ul>
<li>Deferred Age: The commencment or deferred age.

</li>
</ul>
</span>
      </dd>
    
  
    
      <dt>
        <span class='type'>[<tt>Object</tt>]</span>
        <span class='name'>spouseAge</span>
        
      </dt>
      <dd>
        <span class='desc'><ul>
<li>Spousal Age: The spousal commencement age.

</li>
</ul>
</span>
      </dd>
    
  
    
      <dt>
        <span class='type'>[<tt>0.0</tt>, <tt>1.0</tt>, <tt>2.0</tt>, <tt>3.0</tt>, <tt>4.0</tt>]</span>
        <span class='name'>js_type</span>
        
      </dt>
      <dd>
        <span class='desc'><ul>
<li>Joint and Survivor Type: See <tt><a title="#calculate_joint_factor" href="GenFactor.html#calculate_joint_factor-instance_method">#calculate_joint_factor</a></tt> for valid values

</li>
</ul>
</span>
      </dd>
    
  
    
      <dt>
        <span class='type'>[<tt>0.0-1.0</tt>]</span>
        <span class='name'>js_pct</span>
        
      </dt>
      <dd>
        <span class='desc'><ul>
<li>Joint and Survivor Percent: Value between 0.0 and 1.0 that represents the
amount a survivor will receive.

</li>
</ul>
</span>
      </dd>
    
  
    
      <dt>
        <span class='type'>[<tt>Array</tt>]</span>
        <span class='name'>mortality</span>
        
      </dt>
      <dd>
        <span class='desc'><ul>
<li>Mortality table for q(x) lookup

</li>
</ul>
</span>
      </dd>
    
  
    
      <dt>
        <span class='type'>[<tt>0.0-1.0</tt>]</span>
        <span class='name'>seg1</span>
        
      </dt>
      <dd>
        <span class='desc'><ul>
<li>Segment 1: The first segment interest rate.

</li>
</ul>
</span>
      </dd>
    
  
    
      <dt>
        <span class='type'>[<tt>0.0-1.0</tt>]</span>
        <span class='name'>seg2</span>
        
      </dt>
      <dd>
        <span class='desc'><ul>
<li>Segment 2: The second segment interest rate.

</li>
</ul>
</span>
      </dd>
    
  
    
      <dt>
        <span class='type'>[<tt>0.0-1.0</tt>]</span>
        <span class='name'>seg3</span>
        
      </dt>
      <dd>
        <span class='desc'><ul>
<li>Segment 3: The third segment interest rate.

</li>
</ul>
</span>
      </dd>
    
  
    
      <dt>
        <span class='type'>[<tt>Object</tt>]</span>
        <span class='name'>certain</span>
        
      </dt>
      <dd>
        <span class='desc'><ul>
<li>Certain Period: The number of years that the payment is guaranteed.

</li>
</ul>
</span>
      </dd>
    
  
    
      <dt>
        <span class='type'>[<tt>Object</tt>]</span>
        <span class='name'>temp</span>
        
      </dt>
      <dd>
        <span class='desc'><ul>
<li>Temporary Period: The number of years years after the commencement age the
payments will be calculated.

</li>
</ul>
</span>
      </dd>
    
  
    
      <dt>
        <span class='type'>[<tt>Object</tt>]</span>
        <span class='name'>rounding</span>
        
      </dt>
      <dd>
        <span class='desc'><ul>
<li>Rounding: The number of significant figures to round.

</li>
</ul>
</span>
      </dd>
    
  
  </dl>
</div><div class="return">
  <h3>Returns:</h3>
  <dl>
  
    <dt>
      
        <span class='type'>[<tt>float</tt>]</span>
      
      
        <span class='name'></span>
      
      
    </dt>
    <dd>
      <span class='desc'><p>
Present Value Factor
</p>
</span>
    </dd>
  
  </dl>
</div>
<div class="todo">
  <h3>Todo Item:</h3>
  <ul>
  
    <li><strong>protect this method</strong> </li>
  
  </ul>
</div><div class="since">
  <h3>Since:</h3>
  <dl>
  
    <dt>
      
      
      
    </dt>
    <dd>
      <span class='desc'><p>
version 1.0.0
</p>
</span>
    </dd>
  
  </dl>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/udd_factor.rb', line 41</span>

<span class='def def kw'>def</span> <span class='calculate_present_value identifier id'>calculate_present_value</span><span class='lparen token'>(</span><span class='immAge identifier id'>immAge</span><span class='comma token'>,</span><span class='defAge identifier id'>defAge</span><span class='comma token'>,</span><span class='spouseAge identifier id'>spouseAge</span><span class='comma token'>,</span><span class='js_type identifier id'>js_type</span><span class='comma token'>,</span><span class='js_pct identifier id'>js_pct</span><span class='comma token'>,</span><span class='mortality identifier id'>mortality</span><span class='comma token'>,</span><span class='seg1 identifier id'>seg1</span><span class='comma token'>,</span><span class='seg2 identifier id'>seg2</span><span class='comma token'>,</span><span class='seg3 identifier id'>seg3</span><span class='comma token'>,</span><span class='certain identifier id'>certain</span><span class='comma token'>,</span><span class='temp identifier id'>temp</span><span class='comma token'>,</span><span class='rounding identifier id'>rounding</span><span class='rparen token'>)</span>
  <span class='returnValue identifier id'>returnValue</span> <span class='assign token'>=</span> <span class='singlePV identifier id'>singlePV</span> <span class='assign token'>=</span> <span class='spousePV identifier id'>spousePV</span> <span class='assign token'>=</span> <span class='jointPV identifier id'>jointPV</span> <span class='assign token'>=</span> <span class='time identifier id'>time</span> <span class='assign token'>=</span> <span class='payment identifier id'>payment</span> <span class='assign token'>=</span> <span class='integer val'>0</span><span class='integer val'>.0</span>
  <span class='age identifier id'>age</span> <span class='assign token'>=</span> <span class='immAge identifier id'>immAge</span>
  <span class='dAge identifier id'>dAge</span> <span class='assign token'>=</span> <span class='defAge identifier id'>defAge</span>
  <span class='lxZero identifier id'>lxZero</span> <span class='assign token'>=</span> <span class='lxZeroSpouse identifier id'>lxZeroSpouse</span> <span class='assign token'>=</span> <span class='LX_ZERO constant id'>LX_ZERO</span>
  <span class='sAge identifier id'>sAge</span> <span class='assign token'>=</span> <span class='spouseAge identifier id'>spouseAge</span>
  <span class='jointCalc identifier id'>jointCalc</span> <span class='assign token'>=</span> <span class='js_type identifier id'>js_type</span>
 
  <span class='mortalityDiscount identifier id'>mortalityDiscount</span> <span class='assign token'>=</span> <span class='mortalityDiscountSpouse identifier id'>mortalityDiscountSpouse</span> <span class='assign token'>=</span> <span class='mortalityDiscountJoint identifier id'>mortalityDiscountJoint</span> <span class='assign token'>=</span> <span class='float val'>1.0</span>
 
  <span class='lX identifier id'>lX</span> <span class='assign token'>=</span> <span class='lxZero identifier id'>lxZero</span>
  <span class='lXSpouse identifier id'>lXSpouse</span> <span class='assign token'>=</span> <span class='lxZeroSpouse identifier id'>lxZeroSpouse</span>
 
  <span class='dX identifier id'>dX</span> <span class='assign token'>=</span> <span class='calculate_dx identifier id'>calculate_dx</span><span class='lparen token'>(</span><span class='integer val'>0</span><span class='integer val'>.0</span><span class='comma token'>,</span><span class='lX identifier id'>lX</span><span class='comma token'>,</span><span class='age identifier id'>age</span><span class='dot token'>.</span><span class='truncate identifier id'>truncate</span><span class='comma token'>,</span><span class='mortality identifier id'>mortality</span><span class='rparen token'>)</span>
  <span class='dXSpouse identifier id'>dXSpouse</span> <span class='assign token'>=</span> <span class='calculate_dx identifier id'>calculate_dx</span><span class='lparen token'>(</span><span class='integer val'>0</span><span class='integer val'>.0</span><span class='comma token'>,</span><span class='lXSpouse identifier id'>lXSpouse</span><span class='comma token'>,</span><span class='sAge identifier id'>sAge</span><span class='dot token'>.</span><span class='truncate identifier id'>truncate</span><span class='comma token'>,</span><span class='mortality identifier id'>mortality</span><span class='rparen token'>)</span>
 
  <span class='lX identifier id'>lX</span> <span class='assign token'>=</span> <span class='calculate_initial_lx identifier id'>calculate_initial_lx</span><span class='lparen token'>(</span><span class='lX identifier id'>lX</span><span class='comma token'>,</span><span class='dX identifier id'>dX</span><span class='comma token'>,</span><span class='age identifier id'>age</span><span class='rparen token'>)</span>
  <span class='lxZero identifier id'>lxZero</span> <span class='assign token'>=</span> <span class='lX identifier id'>lX</span>
 
  <span class='lXSpouse identifier id'>lXSpouse</span> <span class='assign token'>=</span> <span class='calculate_initial_lx identifier id'>calculate_initial_lx</span><span class='lparen token'>(</span><span class='lXSpouse identifier id'>lXSpouse</span><span class='comma token'>,</span><span class='dXSpouse identifier id'>dXSpouse</span><span class='comma token'>,</span><span class='sAge identifier id'>sAge</span><span class='rparen token'>)</span>
  <span class='lxZeroSpouse identifier id'>lxZeroSpouse</span> <span class='assign token'>=</span> <span class='lXSpouse identifier id'>lXSpouse</span>
 
  <span class='if if kw'>if</span> <span class='integer val'>0</span><span class='integer val'>.0</span> <span class='eq op'>==</span> <span class='lX identifier id'>lX</span>
    <span class='retVal identifier id'>retVal</span> <span class='assign token'>=</span> <span class='integer val'>0</span><span class='integer val'>.0</span> <span class='comment val'>#everyone is already dead yo.</span>
  <span class='else else kw'>else</span>
    <span class='while while kw'>while</span> <span class='lparen token'>(</span><span class='lX identifier id'>lX</span> <span class='gt op'>&gt;</span> <span class='integer val'>0</span><span class='integer val'>.0</span><span class='rparen token'>)</span> <span class='or or kw'>or</span> <span class='lparen token'>(</span><span class='lXSpouse identifier id'>lXSpouse</span> <span class='gt op'>&gt;</span> <span class='integer val'>0</span><span class='integer val'>.0</span> <span class='and and kw'>and</span> <span class='jointCalc identifier id'>jointCalc</span> <span class='gt op'>&gt;</span> <span class='integer val'>0</span><span class='integer val'>.0</span><span class='rparen token'>)</span>
      <span class='if if kw'>if</span> <span class='SEGMENT_TWO constant id'>SEGMENT_TWO</span> <span class='gt op'>&gt;</span> <span class='lparen token'>(</span><span class='time identifier id'>time</span> <span class='div op'>/</span> <span class='float val'>12.0</span><span class='rparen token'>)</span>
        <span class='interestRate identifier id'>interestRate</span> <span class='assign token'>=</span> <span class='seg1 identifier id'>seg1</span>
      <span class='elsif elsif kw'>elsif</span> <span class='SEGMENT_THREE constant id'>SEGMENT_THREE</span> <span class='gt op'>&gt;</span> <span class='lparen token'>(</span><span class='time identifier id'>time</span> <span class='div op'>/</span> <span class='float val'>12.0</span><span class='rparen token'>)</span>
        <span class='interestRate identifier id'>interestRate</span> <span class='assign token'>=</span> <span class='seg2 identifier id'>seg2</span>
      <span class='else else kw'>else</span>
        <span class='interestRate identifier id'>interestRate</span> <span class='assign token'>=</span> <span class='seg3 identifier id'>seg3</span>
      <span class='end end kw'>end</span>
      
      <span class='if if kw'>if</span> <span class='age identifier id'>age</span> <span class='lt op'>&lt;</span> <span class='dAge identifier id'>dAge</span>
        <span class='payment identifier id'>payment</span> <span class='assign token'>=</span> <span class='integer val'>0</span><span class='integer val'>.0</span>
      <span class='else else kw'>else</span>
        <span class='payment identifier id'>payment</span> <span class='assign token'>=</span> <span class='lparen token'>(</span><span class='float val'>1.0</span><span class='div op'>/</span><span class='float val'>12.0</span><span class='rparen token'>)</span>
      <span class='end end kw'>end</span>
      
      <span class='if if kw'>if</span> <span class='temp identifier id'>temp</span> <span class='gt op'>&gt;</span> <span class='integer val'>0</span><span class='integer val'>.0</span>
        <span class='if if kw'>if</span> <span class='age identifier id'>age</span> <span class='geq op'>&gt;=</span> <span class='lparen token'>(</span><span class='temp identifier id'>temp</span> <span class='plus op'>+</span> <span class='dAge identifier id'>dAge</span><span class='rparen token'>)</span>
          <span class='payment identifier id'>payment</span> <span class='assign token'>=</span> <span class='integer val'>0</span><span class='integer val'>.0</span>
        <span class='end end kw'>end</span>
      <span class='end end kw'>end</span>
      
      <span class='singlePV identifier id'>singlePV</span> <span class='opasgn op'>+=</span> <span class='unit_payment identifier id'>unit_payment</span><span class='lparen token'>(</span><span class='mortalityDiscount identifier id'>mortalityDiscount</span><span class='comma token'>,</span><span class='interestRate identifier id'>interestRate</span><span class='comma token'>,</span><span class='time identifier id'>time</span><span class='comma token'>,</span><span class='payment identifier id'>payment</span><span class='rparen token'>)</span>
      <span class='if if kw'>if</span> <span class='jointCalc identifier id'>jointCalc</span> <span class='gt op'>&gt;</span> <span class='integer val'>0</span><span class='integer val'>.0</span> <span class='and and kw'>and</span> <span class='lXSpouse identifier id'>lXSpouse</span> <span class='gt op'>&gt;</span> <span class='integer val'>0</span><span class='integer val'>.0</span>
        <span class='spousePV identifier id'>spousePV</span> <span class='opasgn op'>+=</span> <span class='unit_payment identifier id'>unit_payment</span><span class='lparen token'>(</span><span class='mortalityDiscountSpouse identifier id'>mortalityDiscountSpouse</span><span class='comma token'>,</span><span class='interestRate identifier id'>interestRate</span><span class='comma token'>,</span><span class='time identifier id'>time</span><span class='comma token'>,</span><span class='payment identifier id'>payment</span><span class='rparen token'>)</span>
        <span class='jointPV identifier id'>jointPV</span> <span class='opasgn op'>+=</span> <span class='unit_payment identifier id'>unit_payment</span><span class='lparen token'>(</span><span class='mortalityDiscountJoint identifier id'>mortalityDiscountJoint</span><span class='comma token'>,</span><span class='interestRate identifier id'>interestRate</span><span class='comma token'>,</span><span class='time identifier id'>time</span><span class='comma token'>,</span><span class='payment identifier id'>payment</span><span class='rparen token'>)</span>
      <span class='end end kw'>end</span>
      
      <span class='time identifier id'>time</span> <span class='opasgn op'>+=</span> <span class='float val'>1.0</span>
      <span class='age identifier id'>age</span> <span class='assign token'>=</span> <span class='add_month identifier id'>add_month</span><span class='lparen token'>(</span><span class='age identifier id'>age</span><span class='rparen token'>)</span>
      <span class='if if kw'>if</span> <span class='jointCalc identifier id'>jointCalc</span> <span class='gt op'>&gt;</span> <span class='integer val'>0</span><span class='integer val'>.0</span>  
        <span class='sAge identifier id'>sAge</span> <span class='assign token'>=</span> <span class='add_month identifier id'>add_month</span><span class='lparen token'>(</span><span class='sAge identifier id'>sAge</span><span class='rparen token'>)</span> 
      <span class='end end kw'>end</span>
 
      <span class='lX identifier id'>lX</span> <span class='assign token'>=</span> <span class='lX identifier id'>lX</span> <span class='minus op'>-</span> <span class='dX identifier id'>dX</span>
      <span class='lXSpouse identifier id'>lXSpouse</span> <span class='assign token'>=</span> <span class='lXSpouse identifier id'>lXSpouse</span> <span class='minus op'>-</span> <span class='dXSpouse identifier id'>dXSpouse</span>
 
      <span class='dX identifier id'>dX</span> <span class='assign token'>=</span> <span class='calculate_dx identifier id'>calculate_dx</span><span class='lparen token'>(</span><span class='dX identifier id'>dX</span><span class='comma token'>,</span><span class='lX identifier id'>lX</span><span class='comma token'>,</span><span class='age identifier id'>age</span><span class='comma token'>,</span><span class='mortality identifier id'>mortality</span><span class='rparen token'>)</span>
      <span class='dXSpouse identifier id'>dXSpouse</span> <span class='assign token'>=</span> <span class='calculate_dx identifier id'>calculate_dx</span><span class='lparen token'>(</span><span class='dXSpouse identifier id'>dXSpouse</span><span class='comma token'>,</span><span class='lXSpouse identifier id'>lXSpouse</span><span class='comma token'>,</span><span class='sAge identifier id'>sAge</span><span class='comma token'>,</span><span class='mortality identifier id'>mortality</span><span class='rparen token'>)</span>
      <span class='if if kw'>if</span> <span class='nil nil kw'>nil</span> <span class='neq op'>!=</span> <span class='certain identifier id'>certain</span>
        <span class='if if kw'>if</span> <span class='age identifier id'>age</span> <span class='geq op'>&gt;=</span> <span class='lparen token'>(</span><span class='dAge identifier id'>dAge</span> <span class='plus op'>+</span> <span class='certain identifier id'>certain</span><span class='rparen token'>)</span> <span class='orop op'>||</span> <span class='age identifier id'>age</span> <span class='leq op'>&lt;=</span> <span class='dAge identifier id'>dAge</span>
          <span class='mortalityDiscount identifier id'>mortalityDiscount</span> <span class='assign token'>=</span> <span class='calculate_discount identifier id'>calculate_discount</span><span class='lparen token'>(</span><span class='lX identifier id'>lX</span><span class='comma token'>,</span> <span class='lxZero identifier id'>lxZero</span><span class='rparen token'>)</span>
          <span class='mortalityDiscountSpouse identifier id'>mortalityDiscountSpouse</span> <span class='assign token'>=</span> <span class='calculate_discount identifier id'>calculate_discount</span><span class='lparen token'>(</span><span class='lXSpouse identifier id'>lXSpouse</span><span class='comma token'>,</span><span class='lxZeroSpouse identifier id'>lxZeroSpouse</span><span class='rparen token'>)</span>
          <span class='mortalityDiscountJoint identifier id'>mortalityDiscountJoint</span> <span class='assign token'>=</span> <span class='mortalityDiscount identifier id'>mortalityDiscount</span> <span class='mult op'>*</span> <span class='mortalityDiscountSpouse identifier id'>mortalityDiscountSpouse</span>
        <span class='end end kw'>end</span>
      <span class='else else kw'>else</span>
        <span class='mortalityDiscount identifier id'>mortalityDiscount</span> <span class='assign token'>=</span> <span class='calculate_discount identifier id'>calculate_discount</span><span class='lparen token'>(</span><span class='lX identifier id'>lX</span><span class='comma token'>,</span> <span class='lxZero identifier id'>lxZero</span><span class='rparen token'>)</span>
        <span class='mortalityDiscountSpouse identifier id'>mortalityDiscountSpouse</span> <span class='assign token'>=</span> <span class='calculate_discount identifier id'>calculate_discount</span><span class='lparen token'>(</span><span class='lXSpouse identifier id'>lXSpouse</span><span class='comma token'>,</span><span class='lxZeroSpouse identifier id'>lxZeroSpouse</span><span class='rparen token'>)</span>
        <span class='mortalityDiscountJoint identifier id'>mortalityDiscountJoint</span> <span class='assign token'>=</span> <span class='mortalityDiscount identifier id'>mortalityDiscount</span> <span class='mult op'>*</span> <span class='mortalityDiscountSpouse identifier id'>mortalityDiscountSpouse</span>
      <span class='end end kw'>end</span>
      
    <span class='end end kw'>end</span> <span class='comment val'>#end while 0.0 &lt; lX</span>
  <span class='end end kw'>end</span> <span class='comment val'>#end if lx = 0.0</span>
  
  <span class='returnValue identifier id'>returnValue</span> <span class='assign token'>=</span> <span class='calculate_joint_factor identifier id'>calculate_joint_factor</span><span class='lparen token'>(</span><span class='singlePV identifier id'>singlePV</span><span class='comma token'>,</span><span class='spousePV identifier id'>spousePV</span><span class='comma token'>,</span><span class='jointPV identifier id'>jointPV</span><span class='comma token'>,</span><span class='js_type identifier id'>js_type</span><span class='comma token'>,</span><span class='js_pct identifier id'>js_pct</span><span class='rparen token'>)</span>
  <span class='round_factor identifier id'>round_factor</span><span class='lparen token'>(</span><span class='returnValue identifier id'>returnValue</span><span class='comma token'>,</span><span class='rounding identifier id'>rounding</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>generate_factor</h3>
</div><div id="generate_factor-instance_method" class="section method">
  <div class="details_title">
    <div class='section methodsignature'>
    <tt class='def'>
      <span class='visibility'>public</span>
      <span class='return_types'><tt>float</tt></span>
      <span class='name'>generate_factor</span><span class='args'>(immediateAge = 0.0, commencementAge = 65.0, spAge = 0.0, jsType = 0.0, jsPct = 0.0, mortality = MortalityTable::PPA2009, intSegmentA = 5.0, intSegmentB = 0.0, intSegmentC = 0.0, certainPeriod = 0.0, tempPeriod = 0.0, rounding = 12.0, outputType = 0.0)</span>
      <span class='block'></span>
    </tt>
  </div>

</div><div class="section docstring">
  <p>
Validates input parameters then generates a Present Value Factor.
</p>

</div><div class="section tags">
  <h2>Meta Tags</h2>
  <div class="examples">
  
    <h3>Example: <small>Single Life Annuity Factor</small></h3>
    <div class="docstring">
      <pre class="code"><span class='string val'>&quot;generate_factor(,65.0,,,,MortalityTable::PPA2010,5.44,,,,,)&quot;</span>
</pre>
    </div>
  
</div>
<div class="param">
  <h3>Parameters:</h3>
  <dl>
  
    
      <dt>
        <span class='type'>[<tt>nil</tt>, <tt>float</tt>]</span>
        <span class='name'>immediateAge</span>
        
      </dt>
      <dd>
        <span class='desc'><ul>
<li>Beginning age for deferred calculations. Defaults to commencementAge.

</li>
</ul>
</span>
      </dd>
    
  
    
      <dt>
        <span class='type'>[<tt>float</tt>]</span>
        <span class='name'>commencementAge</span>
        
      </dt>
      <dd>
        <span class='desc'><ul>
<li>Age that payment begins. This parameter is required.

</li>
</ul>
</span>
      </dd>
    
  
    
      <dt>
        <span class='type'>[<tt>nil</tt>, <tt>float</tt>]</span>
        <span class='name'>spAge</span>
        
      </dt>
      <dd>
        <span class='desc'><ul>
<li>Spouse commencement age.

</li>
</ul>
</span>
      </dd>
    
  
    
      <dt>
        <span class='type'>[<tt>nil</tt>, <tt>float</tt>]</span>
        <span class='name'>jsType</span>
        
      </dt>
      <dd>
        <span class='desc'><ul>
<li>Joint and Survivor factor type. Defaults to 0.0

</li>
</ul>
</span>
      </dd>
    
  
    
      <dt>
        <span class='type'>[<tt>nil</tt>, <tt>float</tt>]</span>
        <span class='name'>jsPct</span>
        
      </dt>
      <dd>
        <span class='desc'><ul>
<li>Joint and Survivor percentage. Defaults to 0.0.

</li>
</ul>
</span>
      </dd>
    
  
    
      <dt>
        <span class='type'>[<tt>Array</tt>]</span>
        <span class='name'>mortality</span>
        
      </dt>
      <dd>
        <span class='desc'><ul>
<li>Mortality Table used to fetch q(x) from. Defaults to
<tt><a title="MortalityTable::PPA2009" href="MortalityTable.html#PPA2009-constant">MortalityTable::PPA2009</a></tt>

</li>
</ul>
</span>
      </dd>
    
  
    
      <dt>
        <span class='type'>[<tt>float</tt>]</span>
        <span class='name'>intSegmentA</span>
        
      </dt>
      <dd>
        <span class='desc'><ul>
<li>First interest rate segment. This parameter is required.

</li>
</ul>
</span>
      </dd>
    
  
    
      <dt>
        <span class='type'>[<tt>nil</tt>, <tt>float</tt>]</span>
        <span class='name'>intSegmentB</span>
        
      </dt>
      <dd>
        <span class='desc'><ul>
<li>Second interest rate segment. Defaults to intSegmentA.

</li>
</ul>
</span>
      </dd>
    
  
    
      <dt>
        <span class='type'>[<tt>nil</tt>, <tt>float</tt>]</span>
        <span class='name'>intSegmentC</span>
        
      </dt>
      <dd>
        <span class='desc'><ul>
<li>Third interest rate segment. Defaults to intSegmentA.

</li>
</ul>
</span>
      </dd>
    
  
    
      <dt>
        <span class='type'>[<tt>nil</tt>, <tt>float</tt>]</span>
        <span class='name'>certainPeriod</span>
        
      </dt>
      <dd>
        <span class='desc'><ul>
<li>Guaranteed payment period. Defaults to 0.0.

</li>
</ul>
</span>
      </dd>
    
  
    
      <dt>
        <span class='type'>[<tt>nil</tt>, <tt>float</tt>]</span>
        <span class='name'>tempPeriod</span>
        
      </dt>
      <dd>
        <span class='desc'><ul>
<li>Temporary factor period. Defaults to 0.0.

</li>
</ul>
</span>
      </dd>
    
  
    
      <dt>
        <span class='type'>[<tt>nil</tt>, <tt>float</tt>]</span>
        <span class='name'>rounding</span>
        
      </dt>
      <dd>
        <span class='desc'><ul>
<li>Digits to round to. Defaults to 12.0.

</li>
</ul>
</span>
      </dd>
    
  
    
      <dt>
        <span class='type'>[<tt>nil</tt>, <tt>float</tt>]</span>
        <span class='name'>outputType</span>
        
      </dt>
      <dd>
        <span class='desc'><ul>
<li>If set to 0, runs a factor as normal. Anything else is validation mode.
Validation mode runs the checks, and outputs the error message without
running the <tt><a title="#calculate_present_value" href="#calculate_present_value-instance_method">#calculate_present_value</a></tt> method.

</li>
</ul>
</span>
      </dd>
    
  
  </dl>
</div><div class="return">
  <h3>Returns:</h3>
  <dl>
  
    <dt>
      
        <span class='type'>[<tt>float</tt>, <tt>string</tt>, <tt>true</tt>]</span>
      
      
        <span class='name'></span>
      
      
    </dt>
    <dd>
      <span class='desc'><p>
If outputType = 0, outputs a present value factor or an error message. If
outputType =1 , outputs true or an error message.
</p>
</span>
    </dd>
  
  </dl>
</div>
<div class="raise">
  <h3>Raises:</h3>
  <dl>
  
    <dt>
      
        <span class='type'>[<tt>InvalidFloat</tt>]</span>
      
      
      
    </dt>
    <dd>
      <span class='desc'><p>
if any input parameter cannot be converted to a float, it will produce an
error.
</p>
</span>
    </dd>
  
    <dt>
      
        <span class='type'>[<tt>DefTemp</tt>]</span>
      
      
      
    </dt>
    <dd>
      <span class='desc'><p>
if immediateAge &lt; commencementAge and tempPeriod &gt; 0, will throw an
error.
</p>
</span>
    </dd>
  
    <dt>
      
        <span class='type'>[<tt>ImmComm</tt>]</span>
      
      
      
    </dt>
    <dd>
      <span class='desc'><p>
if immediateAge &gt; commencementAge, will throw an error.
</p>
</span>
    </dd>
  
  </dl>
</div>
<div class="todo">
  <h3>Todo Item:</h3>
  <ul>
  
    <li><strong>Add in verbose mode.</strong> </li>
  
  </ul>
</div><div class="since">
  <h3>Since:</h3>
  <dl>
  
    <dt>
      
      
      
    </dt>
    <dd>
      <span class='desc'><p>
version 1.0.0
</p>
</span>
    </dd>
  
  </dl>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/udd_factor.rb', line 159</span>

<span class='def def kw'>def</span> <span class='generate_factor identifier id'>generate_factor</span><span class='lparen token'>(</span><span class='immediateAge identifier id'>immediateAge</span><span class='assign token'>=</span><span class='integer val'>0</span><span class='integer val'>.0</span><span class='comma token'>,</span><span class='commencementAge identifier id'>commencementAge</span><span class='assign token'>=</span><span class='float val'>65.0</span><span class='comma token'>,</span><span class='spAge identifier id'>spAge</span><span class='assign token'>=</span><span class='integer val'>0</span><span class='integer val'>.0</span><span class='comma token'>,</span>
                    <span class='jsType identifier id'>jsType</span><span class='assign token'>=</span><span class='integer val'>0</span><span class='integer val'>.0</span><span class='comma token'>,</span><span class='jsPct identifier id'>jsPct</span><span class='assign token'>=</span><span class='integer val'>0</span><span class='integer val'>.0</span><span class='comma token'>,</span><span class='mortality identifier id'>mortality</span><span class='assign token'>=</span><span class='MortalityTable constant id'>MortalityTable</span><span class='colon2 op'>::</span><span class='PPA2009 constant id'>PPA2009</span><span class='comma token'>,</span>
                    <span class='intSegmentA identifier id'>intSegmentA</span><span class='assign token'>=</span><span class='float val'>5.0</span><span class='comma token'>,</span><span class='intSegmentB identifier id'>intSegmentB</span><span class='assign token'>=</span><span class='integer val'>0</span><span class='integer val'>.0</span><span class='comma token'>,</span><span class='intSegmentC identifier id'>intSegmentC</span><span class='assign token'>=</span><span class='integer val'>0</span><span class='integer val'>.0</span><span class='comma token'>,</span><span class='certainPeriod identifier id'>certainPeriod</span><span class='assign token'>=</span><span class='integer val'>0</span><span class='integer val'>.0</span><span class='comma token'>,</span>
                    <span class='tempPeriod identifier id'>tempPeriod</span><span class='assign token'>=</span><span class='integer val'>0</span><span class='integer val'>.0</span><span class='comma token'>,</span><span class='rounding identifier id'>rounding</span><span class='assign token'>=</span><span class='float val'>12.0</span><span class='comma token'>,</span><span class='outputType identifier id'>outputType</span><span class='assign token'>=</span><span class='integer val'>0</span><span class='integer val'>.0</span><span class='rparen token'>)</span>
  <span class='errors identifier id'>errors</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
  <span class='immediateCalculation identifier id'>immediateCalculation</span><span class='comma token'>,</span> <span class='jointCalculation identifier id'>jointCalculation</span> <span class='assign token'>=</span> <span class='integer val'>0</span><span class='integer val'>.0</span>
 
  <span class='comment val'>#set default blank input items</span>
  <span class='immediateAge identifier id'>immediateAge</span> <span class='assign token'>=</span> <span class='GenFactor constant id'>GenFactor</span><span class='colon2 op'>::</span><span class='set_default identifier id'>set_default</span><span class='lparen token'>(</span><span class='immediateAge identifier id'>immediateAge</span><span class='comma token'>,</span><span class='commencementAge identifier id'>commencementAge</span><span class='rparen token'>)</span>
  <span class='spAge identifier id'>spAge</span> <span class='assign token'>=</span> <span class='GenFactor constant id'>GenFactor</span><span class='colon2 op'>::</span><span class='set_default identifier id'>set_default</span><span class='lparen token'>(</span><span class='spAge identifier id'>spAge</span><span class='comma token'>,</span><span class='integer val'>0</span><span class='integer val'>.0</span><span class='rparen token'>)</span>
  <span class='jsType identifier id'>jsType</span> <span class='assign token'>=</span> <span class='GenFactor constant id'>GenFactor</span><span class='colon2 op'>::</span><span class='set_default identifier id'>set_default</span><span class='lparen token'>(</span><span class='jsType identifier id'>jsType</span><span class='comma token'>,</span><span class='integer val'>0</span><span class='integer val'>.0</span><span class='rparen token'>)</span>
  <span class='jsPct identifier id'>jsPct</span> <span class='assign token'>=</span> <span class='GenFactor constant id'>GenFactor</span><span class='colon2 op'>::</span><span class='set_default identifier id'>set_default</span><span class='lparen token'>(</span><span class='jsPct identifier id'>jsPct</span><span class='comma token'>,</span><span class='integer val'>0</span><span class='integer val'>.0</span><span class='rparen token'>)</span>
  <span class='mortality identifier id'>mortality</span> <span class='assign token'>=</span> <span class='GenFactor constant id'>GenFactor</span><span class='colon2 op'>::</span><span class='set_default identifier id'>set_default</span><span class='lparen token'>(</span><span class='mortality identifier id'>mortality</span><span class='comma token'>,</span><span class='MortalityTable constant id'>MortalityTable</span><span class='colon2 op'>::</span><span class='PPA2009 constant id'>PPA2009</span><span class='rparen token'>)</span>
  <span class='intSegmentB identifier id'>intSegmentB</span> <span class='assign token'>=</span> <span class='GenFactor constant id'>GenFactor</span><span class='colon2 op'>::</span><span class='set_default identifier id'>set_default</span><span class='lparen token'>(</span><span class='intSegmentB identifier id'>intSegmentB</span><span class='comma token'>,</span><span class='intSegmentA identifier id'>intSegmentA</span><span class='rparen token'>)</span>
  <span class='intSegmentC identifier id'>intSegmentC</span> <span class='assign token'>=</span> <span class='GenFactor constant id'>GenFactor</span><span class='colon2 op'>::</span><span class='set_default identifier id'>set_default</span><span class='lparen token'>(</span><span class='intSegmentC identifier id'>intSegmentC</span><span class='comma token'>,</span><span class='intSegmentA identifier id'>intSegmentA</span><span class='rparen token'>)</span>
  <span class='certainPeriod identifier id'>certainPeriod</span> <span class='assign token'>=</span> <span class='GenFactor constant id'>GenFactor</span><span class='colon2 op'>::</span><span class='set_default identifier id'>set_default</span><span class='lparen token'>(</span><span class='certainPeriod identifier id'>certainPeriod</span><span class='comma token'>,</span><span class='integer val'>0</span><span class='integer val'>.0</span><span class='rparen token'>)</span>
  <span class='tempPeriod identifier id'>tempPeriod</span> <span class='assign token'>=</span> <span class='GenFactor constant id'>GenFactor</span><span class='colon2 op'>::</span><span class='set_default identifier id'>set_default</span><span class='lparen token'>(</span><span class='tempPeriod identifier id'>tempPeriod</span><span class='comma token'>,</span><span class='integer val'>0</span><span class='integer val'>.0</span><span class='rparen token'>)</span>
  <span class='rounding identifier id'>rounding</span> <span class='assign token'>=</span> <span class='GenFactor constant id'>GenFactor</span><span class='colon2 op'>::</span><span class='set_default identifier id'>set_default</span><span class='lparen token'>(</span><span class='rounding identifier id'>rounding</span><span class='comma token'>,</span><span class='float val'>12.0</span><span class='rparen token'>)</span>
 
  <span class='comment val'>#check to make sure we can do the calculation first</span>
  <span class='begin begin kw'>begin</span> 
    <span class='immediateAge identifier id'>immediateAge</span> <span class='assign token'>=</span> <span class='GenFactor constant id'>GenFactor</span><span class='colon2 op'>::</span><span class='sanitize_age identifier id'>sanitize_age</span><span class='lparen token'>(</span><span class='Float constant id'>Float</span><span class='lparen token'>(</span><span class='immediateAge identifier id'>immediateAge</span><span class='rparen token'>)</span><span class='rparen token'>)</span> 
  <span class='rescue rescue kw'>rescue</span>
    <span class='errorString identifier id'>errorString</span> <span class='assign token'>=</span> <span class='string val'>&quot;Immediate age cannot be converted into a number&quot;</span>
    <span class='errors identifier id'>errors</span> <span class='assign token'>=</span> <span class='GenFactor constant id'>GenFactor</span><span class='colon2 op'>::</span><span class='append_error identifier id'>append_error</span><span class='lparen token'>(</span><span class='errors identifier id'>errors</span><span class='comma token'>,</span><span class='errorString identifier id'>errorString</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span> 
  <span class='begin begin kw'>begin</span>
    <span class='commencementAge identifier id'>commencementAge</span> <span class='assign token'>=</span> <span class='GenFactor constant id'>GenFactor</span><span class='colon2 op'>::</span><span class='sanitize_age identifier id'>sanitize_age</span><span class='lparen token'>(</span><span class='Float constant id'>Float</span><span class='lparen token'>(</span><span class='commencementAge identifier id'>commencementAge</span><span class='rparen token'>)</span><span class='rparen token'>)</span>  
  <span class='rescue rescue kw'>rescue</span>
    <span class='errorString identifier id'>errorString</span> <span class='assign token'>=</span> <span class='string val'>&quot;Commencement age cannot be converted into a number&quot;</span>
    <span class='errors identifier id'>errors</span> <span class='assign token'>=</span> <span class='GenFactor constant id'>GenFactor</span><span class='colon2 op'>::</span><span class='append_error identifier id'>append_error</span><span class='lparen token'>(</span><span class='errors identifier id'>errors</span><span class='comma token'>,</span><span class='errorString identifier id'>errorString</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
  <span class='begin begin kw'>begin</span>
    <span class='spAge identifier id'>spAge</span> <span class='assign token'>=</span> <span class='GenFactor constant id'>GenFactor</span><span class='colon2 op'>::</span><span class='sanitize_age identifier id'>sanitize_age</span><span class='lparen token'>(</span><span class='Float constant id'>Float</span><span class='lparen token'>(</span><span class='spAge identifier id'>spAge</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
  <span class='rescue rescue kw'>rescue</span>
    <span class='errorString identifier id'>errorString</span> <span class='assign token'>=</span> <span class='string val'>&quot;Spousal age cannot be converted into a number&quot;</span>
    <span class='errors identifier id'>errors</span> <span class='assign token'>=</span> <span class='GenFactor constant id'>GenFactor</span><span class='colon2 op'>::</span><span class='append_error identifier id'>append_error</span><span class='lparen token'>(</span><span class='errors identifier id'>errors</span><span class='comma token'>,</span><span class='errorString identifier id'>errorString</span><span class='rparen token'>)</span>        
  <span class='end end kw'>end</span>
  <span class='begin begin kw'>begin</span>
    <span class='jsType identifier id'>jsType</span> <span class='assign token'>=</span> <span class='GenFactor constant id'>GenFactor</span><span class='colon2 op'>::</span><span class='sanitize_js_type identifier id'>sanitize_js_type</span><span class='lparen token'>(</span><span class='Float constant id'>Float</span><span class='lparen token'>(</span><span class='jsType identifier id'>jsType</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
  <span class='rescue rescue kw'>rescue</span>
    <span class='errorString identifier id'>errorString</span> <span class='assign token'>=</span> <span class='string val'>&quot;JS Type cannot be converted into a number&quot;</span>   
    <span class='errors identifier id'>errors</span> <span class='assign token'>=</span> <span class='GenFactor constant id'>GenFactor</span><span class='colon2 op'>::</span><span class='append_error identifier id'>append_error</span><span class='lparen token'>(</span><span class='errors identifier id'>errors</span><span class='comma token'>,</span><span class='errorString identifier id'>errorString</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
  <span class='comment val'>#mortality validation time.  </span>
  <span class='unless unless kw'>unless</span> <span class='mortality identifier id'>mortality</span><span class='dot token'>.</span><span class='is_a? fid id'>is_a?</span> <span class='Array constant id'>Array</span>
    <span class='errorString identifier id'>errorString</span> <span class='assign token'>=</span> <span class='string val'>&quot;Mortality Table must be an array&quot;</span>
    <span class='errors identifier id'>errors</span> <span class='assign token'>=</span> <span class='GenFactor constant id'>GenFactor</span><span class='colon2 op'>::</span><span class='append_error identifier id'>append_error</span><span class='lparen token'>(</span><span class='errors identifier id'>errors</span><span class='comma token'>,</span><span class='errorString identifier id'>errorString</span><span class='rparen token'>)</span>
  <span class='else else kw'>else</span>
    <span class='cErrorCount identifier id'>cErrorCount</span> <span class='assign token'>=</span> <span class='integer val'>0</span><span class='integer val'>.0</span>
    <span class='mortality identifier id'>mortality</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='ii identifier id'>ii</span><span class='bitor op'>|</span>
      <span class='begin begin kw'>begin</span>
        <span class='tempy identifier id'>tempy</span> <span class='assign token'>=</span> <span class='ii identifier id'>ii</span>
        <span class='tempo identifier id'>tempo</span> <span class='assign token'>=</span> <span class='Float constant id'>Float</span><span class='lparen token'>(</span><span class='tempy identifier id'>tempy</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
        <span class='tempsan identifier id'>tempsan</span> <span class='assign token'>=</span> <span class='Float constant id'>Float</span><span class='lparen token'>(</span><span class='tempy identifier id'>tempy</span><span class='lbrack token'>[</span><span class='integer val'>1</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
      <span class='rescue rescue kw'>rescue</span>
          <span class='cErrorCount identifier id'>cErrorCount</span> <span class='opasgn op'>+=</span> <span class='float val'>1.0</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>
    <span class='if if kw'>if</span> <span class='cErrorCount identifier id'>cErrorCount</span> <span class='gt op'>&gt;</span> <span class='integer val'>0</span><span class='integer val'>.0</span>
      <span class='errorString identifier id'>errorString</span> <span class='assign token'>=</span> <span class='string val'>&quot;Invalid mortality table format: cannot convert all elements to numbers&quot;</span>
      <span class='errors identifier id'>errors</span> <span class='assign token'>=</span> <span class='GenFactor constant id'>GenFactor</span><span class='colon2 op'>::</span><span class='append_error identifier id'>append_error</span><span class='lparen token'>(</span><span class='errors identifier id'>errors</span><span class='comma token'>,</span><span class='errorString identifier id'>errorString</span><span class='rparen token'>)</span>
    <span class='else else kw'>else</span>
      <span class='unless unless kw'>unless</span> <span class='lparen token'>(</span><span class='mortality identifier id'>mortality</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span> <span class='eq op'>==</span> <span class='integer val'>0</span><span class='integer val'>.0</span><span class='rparen token'>)</span> <span class='and and kw'>and</span> <span class='lparen token'>(</span><span class='mortality identifier id'>mortality</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='integer val'>1</span><span class='rbrack token'>]</span> <span class='eq op'>==</span> <span class='integer val'>0</span><span class='integer val'>.0</span><span class='rparen token'>)</span>
        <span class='errorString identifier id'>errorString</span> <span class='assign token'>=</span> <span class='string val'>&quot;Invalid mortality table format: first row is not 0.0,0.0&quot;</span>
        <span class='errors identifier id'>errors</span> <span class='assign token'>=</span> <span class='GenFactor constant id'>GenFactor</span><span class='colon2 op'>::</span><span class='append_error identifier id'>append_error</span><span class='lparen token'>(</span><span class='errors identifier id'>errors</span><span class='comma token'>,</span><span class='errorString identifier id'>errorString</span><span class='rparen token'>)</span>
      <span class='end end kw'>end</span>
      <span class='unless unless kw'>unless</span> <span class='mortality identifier id'>mortality</span><span class='lbrack token'>[</span><span class='integer val'>-1</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='integer val'>1</span><span class='rbrack token'>]</span> <span class='eq op'>==</span> <span class='float val'>1.0</span>
        <span class='errorString identifier id'>errorString</span> <span class='assign token'>=</span> <span class='string val'>&quot;Invalid mortality table format: last row does not have a q(x) of 1.0&quot;</span>
        <span class='errors identifier id'>errors</span> <span class='assign token'>=</span> <span class='GenFactor constant id'>GenFactor</span><span class='colon2 op'>::</span><span class='append_error identifier id'>append_error</span><span class='lparen token'>(</span><span class='errors identifier id'>errors</span><span class='comma token'>,</span><span class='errorString identifier id'>errorString</span><span class='rparen token'>)</span>
      <span class='end end kw'>end</span>        
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
  <span class='begin begin kw'>begin</span>
    <span class='jsPct identifier id'>jsPct</span> <span class='assign token'>=</span> <span class='GenFactor constant id'>GenFactor</span><span class='colon2 op'>::</span><span class='sanitize_js_pct identifier id'>sanitize_js_pct</span><span class='lparen token'>(</span><span class='Float constant id'>Float</span><span class='lparen token'>(</span><span class='jsPct identifier id'>jsPct</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
  <span class='rescue rescue kw'>rescue</span>
    <span class='errorString identifier id'>errorString</span> <span class='assign token'>=</span> <span class='string val'>&quot;JS percent cannot be converted into a number&quot;</span>    
    <span class='errors identifier id'>errors</span> <span class='assign token'>=</span> <span class='GenFactor constant id'>GenFactor</span><span class='colon2 op'>::</span><span class='append_error identifier id'>append_error</span><span class='lparen token'>(</span><span class='errors identifier id'>errors</span><span class='comma token'>,</span><span class='errorString identifier id'>errorString</span><span class='rparen token'>)</span>    
  <span class='end end kw'>end</span>
  <span class='begin begin kw'>begin</span>
    <span class='intSegmentA identifier id'>intSegmentA</span> <span class='assign token'>=</span> <span class='GenFactor constant id'>GenFactor</span><span class='colon2 op'>::</span><span class='sanitize_interest identifier id'>sanitize_interest</span><span class='lparen token'>(</span><span class='Float constant id'>Float</span><span class='lparen token'>(</span><span class='intSegmentA identifier id'>intSegmentA</span><span class='rparen token'>)</span><span class='rparen token'>)</span>      
  <span class='rescue rescue kw'>rescue</span>
    <span class='errorString identifier id'>errorString</span> <span class='assign token'>=</span> <span class='string val'>&quot;Interest segment A cannot be converted into a number&quot;</span>    
    <span class='errors identifier id'>errors</span> <span class='assign token'>=</span> <span class='GenFactor constant id'>GenFactor</span><span class='colon2 op'>::</span><span class='append_error identifier id'>append_error</span><span class='lparen token'>(</span><span class='errors identifier id'>errors</span><span class='comma token'>,</span><span class='errorString identifier id'>errorString</span><span class='rparen token'>)</span>      
  <span class='end end kw'>end</span>
  <span class='begin begin kw'>begin</span>
    <span class='intSegmentB identifier id'>intSegmentB</span> <span class='assign token'>=</span> <span class='GenFactor constant id'>GenFactor</span><span class='colon2 op'>::</span><span class='sanitize_interest identifier id'>sanitize_interest</span><span class='lparen token'>(</span><span class='Float constant id'>Float</span><span class='lparen token'>(</span><span class='intSegmentB identifier id'>intSegmentB</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
  <span class='rescue rescue kw'>rescue</span>
    <span class='errorString identifier id'>errorString</span> <span class='assign token'>=</span> <span class='string val'>&quot;Interest segment B cannot be converted into a number&quot;</span>    
    <span class='errors identifier id'>errors</span> <span class='assign token'>=</span> <span class='GenFactor constant id'>GenFactor</span><span class='colon2 op'>::</span><span class='append_error identifier id'>append_error</span><span class='lparen token'>(</span><span class='errors identifier id'>errors</span><span class='comma token'>,</span><span class='errorString identifier id'>errorString</span><span class='rparen token'>)</span>            
  <span class='end end kw'>end</span>
  <span class='begin begin kw'>begin</span>
    <span class='intSegmentC identifier id'>intSegmentC</span> <span class='assign token'>=</span> <span class='GenFactor constant id'>GenFactor</span><span class='colon2 op'>::</span><span class='sanitize_interest identifier id'>sanitize_interest</span><span class='lparen token'>(</span><span class='Float constant id'>Float</span><span class='lparen token'>(</span><span class='intSegmentC identifier id'>intSegmentC</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
  <span class='rescue rescue kw'>rescue</span>
    <span class='errorString identifier id'>errorString</span> <span class='assign token'>=</span> <span class='string val'>&quot;Interest segment C cannot be converted into a number&quot;</span>    
    <span class='errors identifier id'>errors</span> <span class='assign token'>=</span> <span class='GenFactor constant id'>GenFactor</span><span class='colon2 op'>::</span><span class='append_error identifier id'>append_error</span><span class='lparen token'>(</span><span class='errors identifier id'>errors</span><span class='comma token'>,</span><span class='errorString identifier id'>errorString</span><span class='rparen token'>)</span>      
  <span class='end end kw'>end</span>
  <span class='begin begin kw'>begin</span>
    <span class='certainPeriod identifier id'>certainPeriod</span> <span class='assign token'>=</span> <span class='GenFactor constant id'>GenFactor</span><span class='colon2 op'>::</span><span class='sanitize_age identifier id'>sanitize_age</span><span class='lparen token'>(</span><span class='Float constant id'>Float</span><span class='lparen token'>(</span><span class='certainPeriod identifier id'>certainPeriod</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
  <span class='rescue rescue kw'>rescue</span>
    <span class='errorString identifier id'>errorString</span> <span class='assign token'>=</span> <span class='string val'>&quot;Certain period cannot be converted into a number&quot;</span>    
    <span class='errors identifier id'>errors</span> <span class='assign token'>=</span> <span class='GenFactor constant id'>GenFactor</span><span class='colon2 op'>::</span><span class='append_error identifier id'>append_error</span><span class='lparen token'>(</span><span class='errors identifier id'>errors</span><span class='comma token'>,</span><span class='errorString identifier id'>errorString</span><span class='rparen token'>)</span>            
  <span class='end end kw'>end</span>
  <span class='begin begin kw'>begin</span>
    <span class='tempPeriod identifier id'>tempPeriod</span> <span class='assign token'>=</span> <span class='GenFactor constant id'>GenFactor</span><span class='colon2 op'>::</span><span class='sanitize_age identifier id'>sanitize_age</span><span class='lparen token'>(</span><span class='Float constant id'>Float</span><span class='lparen token'>(</span><span class='tempPeriod identifier id'>tempPeriod</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
  <span class='rescue rescue kw'>rescue</span>
    <span class='errorString identifier id'>errorString</span> <span class='assign token'>=</span> <span class='string val'>&quot;Temporary period cannot be converted into a number&quot;</span>    
    <span class='errors identifier id'>errors</span> <span class='assign token'>=</span> <span class='GenFactor constant id'>GenFactor</span><span class='colon2 op'>::</span><span class='append_error identifier id'>append_error</span><span class='lparen token'>(</span><span class='errors identifier id'>errors</span><span class='comma token'>,</span><span class='errorString identifier id'>errorString</span><span class='rparen token'>)</span>            
  <span class='end end kw'>end</span>
  <span class='begin begin kw'>begin</span>
    <span class='rounding identifier id'>rounding</span> <span class='assign token'>=</span> <span class='Float constant id'>Float</span><span class='lparen token'>(</span><span class='rounding identifier id'>rounding</span><span class='rparen token'>)</span>
  <span class='rescue rescue kw'>rescue</span>
    <span class='errorString identifier id'>errorString</span> <span class='assign token'>=</span> <span class='string val'>&quot;Rounding cannot be converted into a number&quot;</span>    
    <span class='errors identifier id'>errors</span> <span class='assign token'>=</span> <span class='GenFactor constant id'>GenFactor</span><span class='colon2 op'>::</span><span class='append_error identifier id'>append_error</span><span class='lparen token'>(</span><span class='errors identifier id'>errors</span><span class='comma token'>,</span><span class='errorString identifier id'>errorString</span><span class='rparen token'>)</span>      
  <span class='end end kw'>end</span>
  
  <span class='if if kw'>if</span> <span class='errors identifier id'>errors</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span>
    <span class='comment val'>#now check for logical errors</span>
    <span class='if if kw'>if</span> <span class='lparen token'>(</span><span class='immediateAge identifier id'>immediateAge</span> <span class='lt op'>&lt;</span> <span class='commencementAge identifier id'>commencementAge</span><span class='rparen token'>)</span> <span class='andop op'>&amp;&amp;</span> <span class='lparen token'>(</span><span class='tempPeriod identifier id'>tempPeriod</span> <span class='gt op'>&gt;</span> <span class='integer val'>0</span><span class='integer val'>.0</span><span class='rparen token'>)</span>
      <span class='errorString identifier id'>errorString</span> <span class='assign token'>=</span> <span class='string val'>&quot;Error: Deferred Calculation with a Temporary Period&quot;</span>
      <span class='errors identifier id'>errors</span> <span class='assign token'>=</span> <span class='GenFactor constant id'>GenFactor</span><span class='colon2 op'>::</span><span class='append_error identifier id'>append_error</span><span class='lparen token'>(</span><span class='errors identifier id'>errors</span><span class='comma token'>,</span><span class='errorString identifier id'>errorString</span><span class='rparen token'>)</span> 
    <span class='end end kw'>end</span>
    
    <span class='if if kw'>if</span> <span class='lparen token'>(</span><span class='immediateAge identifier id'>immediateAge</span> <span class='gt op'>&gt;</span> <span class='commencementAge identifier id'>commencementAge</span><span class='rparen token'>)</span>
      <span class='errorString identifier id'>errorString</span> <span class='assign token'>=</span> <span class='string val'>&quot;Error: Commencement age must be greater than or equal to immediate age&quot;</span>
      <span class='errors identifier id'>errors</span> <span class='assign token'>=</span> <span class='GenFactor constant id'>GenFactor</span><span class='colon2 op'>::</span><span class='append_error identifier id'>append_error</span><span class='lparen token'>(</span><span class='errors identifier id'>errors</span><span class='comma token'>,</span><span class='errorString identifier id'>errorString</span><span class='rparen token'>)</span>          
    <span class='end end kw'>end</span>
    
  <span class='end end kw'>end</span> <span class='comment val'>#if errors.empty?</span>
  
  <span class='if if kw'>if</span> <span class='errors identifier id'>errors</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span>
    <span class='if if kw'>if</span> <span class='integer val'>0</span> <span class='eq op'>==</span> <span class='outputType identifier id'>outputType</span>
      <span class='calculate_present_value identifier id'>calculate_present_value</span><span class='lparen token'>(</span><span class='immediateAge identifier id'>immediateAge</span><span class='comma token'>,</span><span class='commencementAge identifier id'>commencementAge</span><span class='comma token'>,</span><span class='spAge identifier id'>spAge</span><span class='comma token'>,</span><span class='jsType identifier id'>jsType</span><span class='comma token'>,</span><span class='jsPct identifier id'>jsPct</span><span class='comma token'>,</span><span class='mortality identifier id'>mortality</span><span class='comma token'>,</span>
                              <span class='intSegmentA identifier id'>intSegmentA</span><span class='comma token'>,</span><span class='intSegmentB identifier id'>intSegmentB</span><span class='comma token'>,</span><span class='intSegmentC identifier id'>intSegmentC</span><span class='comma token'>,</span><span class='certainPeriod identifier id'>certainPeriod</span><span class='comma token'>,</span>
                              <span class='tempPeriod identifier id'>tempPeriod</span><span class='comma token'>,</span><span class='rounding identifier id'>rounding</span><span class='rparen token'>)</span>
    <span class='else else kw'>else</span>
      <span class='true true kw'>true</span>
    <span class='end end kw'>end</span> <span class='comment val'>#if outputType is 0</span>
    
  <span class='else else kw'>else</span> <span class='comment val'>#errors is not empty</span>
    <span class='errors identifier id'>errors</span>
  <span class='end end kw'>end</span> <span class='comment val'>#if errors.empty?</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
</div>
  </div>

</div>
    </div>
    <div id="yard_info">
  Generated on Friday, September 11 2009 at 02:54:16 PM by 
  <abbr class="yard" title="Yay! A Ruby Documentation Tool"><a href="http://yard.soen.ca">YARD</a></abbr> 
  0.2.3.5 (ruby-1.8.6).
</div>

  </body>
</html>